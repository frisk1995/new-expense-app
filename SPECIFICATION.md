# 経費建て替え管理アプリ 仕様書

## 1. 概要

### 1.1 目的
プロジェクトメンバー間での経費建て替えを記録・管理するWebアプリケーション

### 1.2 対象ユーザー
- プロジェクトに参加する複数のメンバー
- スマートフォンから操作

### 1.3 インフラ
- Firebase（無料枠）
  - Firestore：データベース
  - Firebase Hosting：ホスティング

---

## 2. 主要機能

### 2.1 プロジェクト管理

#### 2.1.1 プロジェクト作成
- プロジェクト名を入力して新規作成
- プロジェクトIDを自動生成（共有用）

#### 2.1.2 プロジェクト参加
- プロジェクトID入力
- ユーザー名選択（既存ユーザー一覧から）または新規追加
- プロジェクトをローカルストレージに保存（再訪時に自動表示）

#### 2.1.3 プロジェクト切り替え
- 参加中のプロジェクト一覧表示
- タップで切り替え

### 2.2 ユーザー管理

#### 2.2.1 ユーザー追加
- プロジェクト内にユーザーを追加
- ユーザー名のみ（重複可）

#### 2.2.2 ユーザー編集
- ユーザー名の変更

#### 2.2.3 ユーザー削除
- 建て替え記録がある場合は削除不可
- 警告表示

### 2.3 建て替え記録管理

#### 2.3.1 建て替え記録登録
- 入力項目：
  - 支払者（誰が）：プロジェクト内ユーザーから選択
  - 受益者（誰の分を）：プロジェクト内ユーザーから選択（複数選択可）
  - 金額：数値入力
  - メモ：テキスト入力（任意）
  - 日付：デフォルトは今日（変更可）
- バリデーション：
  - 支払者と受益者が同じ場合は警告
  - 金額は正の数値のみ

#### 2.3.2 建て替え記録一覧
- 日付順（新しい順）で表示
- 表示項目：
  - 日付
  - 支払者名
  - 受益者名（複数の場合はカンマ区切り）
  - 金額
  - メモ（あれば）
- フィルター機能：
  - 支払者で絞り込み
  - 受益者で絞り込み
  - 期間で絞り込み

#### 2.3.3 建て替え記録編集
- 全項目編集可能

#### 2.3.4 建て替え記録削除
- 確認ダイアログ表示
- 削除実行

### 2.4 清算機能

#### 2.4.1 残高表示
- ユーザーごとの収支を表示
  - プラス：受け取る金額
  - マイナス：支払う金額
- 計算ロジック：
  - 支払者：支払った金額を加算
  - 受益者：受益した金額を減算

#### 2.4.2 清算提案
- 最小取引回数で清算する方法を提示
- 例：「AさんがBさんに1000円支払う」

---

## 3. データ構造

### 3.1 Firestoreコレクション

#### projects コレクション
```javascript
{
  id: "auto-generated",
  name: "プロジェクト名",
  createdAt: timestamp,
  updatedAt: timestamp
}
```

#### projects/{projectId}/users サブコレクション
```javascript
{
  id: "auto-generated",
  name: "ユーザー名",
  createdAt: timestamp
}
```

#### projects/{projectId}/expenses サブコレクション
```javascript
{
  id: "auto-generated",
  payerId: "支払者のユーザーID",
  payerName: "支払者名（スナップショット）",
  beneficiaries: [
    {
      userId: "受益者のユーザーID",
      userName: "受益者名（スナップショット）"
    }
  ],
  amount: 1000,
  memo: "メモ",
  date: timestamp,
  createdAt: timestamp,
  updatedAt: timestamp
}
```

### 3.2 ローカルストレージ

```javascript
{
  currentProjectId: "現在のプロジェクトID",
  currentUserId: "現在のユーザーID",
  projects: [
    {
      projectId: "プロジェクトID",
      projectName: "プロジェクト名",
      userId: "このプロジェクトでのユーザーID",
      userName: "ユーザー名"
    }
  ]
}
```

---

## 4. 画面構成

### 4.1 プロジェクト選択画面（初回/切り替え時）
- 参加中プロジェクト一覧
- 新規プロジェクト作成ボタン
- プロジェクトに参加ボタン

### 4.2 ユーザー選択画面（プロジェクト参加時）
- プロジェクト名表示
- 既存ユーザー一覧
- 新しいユーザーとして参加ボタン

### 4.3 メイン画面
- ヘッダー：
  - プロジェクト名
  - 現在のユーザー名
  - メニューボタン
- タブ切り替え：
  - 建て替え一覧
  - 清算
  - ユーザー管理
- フローティングボタン：建て替え記録追加

### 4.4 建て替え記録一覧タブ
- 記録カード（タップで編集）
- フィルターボタン

### 4.5 清算タブ
- ユーザー別残高リスト
- 清算提案セクション

### 4.6 ユーザー管理タブ
- ユーザー一覧（編集・削除可能）
- ユーザー追加ボタン

### 4.7 建て替え記録追加/編集モーダル
- フォーム
- 保存/キャンセルボタン

---

## 5. 非機能要件

### 5.1 レスポンシブデザイン
- スマートフォン最適化（縦向き）
- タブレット対応

### 5.2 オフライン対応
- 不要（常時オンライン前提）

### 5.3 パフォーマンス
- 初回読み込み：3秒以内
- 画面遷移：1秒以内

### 5.4 セキュリティ
- Firestoreセキュリティルール設定
- プロジェクトIDを知っている人のみアクセス可能

---

## 6. 技術スタック提案

### 6.1 フロントエンド
**推奨：React + Vite**
- 理由：
  - 高速なビルド
  - シンプルな設定
  - 豊富なエコシステム
  - Firebase SDKとの相性が良い

**代替案：Vue + Vite**
- よりシンプルな学習曲線

### 6.2 UIライブラリ
**推奨：Tailwind CSS + DaisyUI**
- レスポンシブデザインが容易
- コンポーネントが豊富

**代替案：Material-UI (MUI)**
- Googleデザインに準拠

### 6.3 状態管理
**推奨：React Context API**
- 小規模アプリに最適
- 追加ライブラリ不要

### 6.4 Firebase SDK
- Firebase JS SDK v9+（モジュラーAPI）

---

## 7. 開発フェーズ

### Phase 1: 基本機能（MVP）
1. プロジェクト作成・参加
2. ユーザー選択・追加
3. 建て替え記録のCRUD
4. 基本的な残高表示

### Phase 2: 機能拡張
1. フィルター機能
2. 清算提案アルゴリズム
3. ユーザー管理機能

### Phase 3: UI/UX改善
1. アニメーション
2. エラーハンドリング強化
3. ローディング状態改善

---

## 8. 今後の拡張案

- レシート写真添付
- カテゴリ分類
- エクスポート機能（CSV）
- 通知機能
- PWA化（オフライン対応）
